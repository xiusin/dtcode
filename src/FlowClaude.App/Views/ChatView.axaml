<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FlowClaude.App.ViewModels"
             xmlns:controls="using:FlowClaude.App.Controls"
             x:Class="FlowClaude.App.Views.ChatView"
             x:DataType="vm:ChatViewModel">
  
  <Grid RowDefinitions="*,Auto,Auto">
    
    <!-- Chat Messages Area -->
    <ScrollViewer Grid.Row="0"
                  Name="MessagesScroll"
                  VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled"
                  Padding="16,16,16,8">
      
      <StackPanel Spacing="16">
        
        <!-- Welcome / Empty State -->
        <StackPanel IsVisible="{Binding Messages.Count, Converter={StaticResource NumberToBoolConverter}, ConverterParameter=Invert}}"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Margin="0,60">
          <Border Background="{DynamicResource SurfaceColor}" 
                  CornerRadius="16" 
                  Padding="48,56">
            <StackPanel>
              <PathIcon Data="{StaticResource BotIcon}" 
                        Width="64" Height="64"
                        Foreground="{DynamicResource PrimaryColor}"
                        HorizontalAlignment="Center"/>
              <TextBlock Text="How can I help you today?" 
                         FontSize="22" 
                         FontWeight="600"
                         HorizontalAlignment="Center"
                         Margin="0,24,0,8"
                         Foreground="{DynamicResource AppForeground}"/>
              <TextBlock Text="Ask me to help with coding, debugging, or any development task" 
                         Foreground="{DynamicResource MutedForeground}"
                         HorizontalAlignment="Center"
                         TextAlignment="Center"
                         FontSize="14"
                         MaxWidth="300"/>
              
              <!-- Suggested Prompts -->
              <StackPanel Margin="0,32,0,0" Spacing="12" HorizontalAlignment="Center">
                <controls:SuggestionChip Content="Review my code for bugs"
                                         Command="{Binding SendMessageCommand}"
                                         CommandParameter="Review my code for bugs"/>
                <controls:SuggestionChip Content="Help me implement a new feature"
                                         Command="{Binding SendMessageCommand}"
                                         CommandParameter="Help me implement a new feature"/>
                <controls:SuggestionChip Content="Explain how this code works"
                                         Command="{Binding SendMessageCommand}"
                                         CommandParameter="Explain how this code works"/>
              </StackPanel>
            </StackPanel>
          </Border>
        </StackPanel>
        
        <!-- Messages -->
        <ItemsControl ItemsSource="{Binding Messages}">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <controls:ChatMessageView 
                  Role="{Binding Role}"
                  Content="{Binding Content}"
                  IsStreaming="{Binding IsStreaming}"
                  IsError="{Binding IsError}"
                  Timestamp="{Binding Timestamp}"/>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
        
        <!-- Active Tool Calls -->
        <ItemsControl ItemsSource="{Binding ActiveToolCalls}"
                      IsVisible="{Binding ActiveToolCalls.Count, Converter={StaticResource NumberToBoolConverter}}">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <controls:ToolCallItem ToolName="{Binding ToolName}"
                                     Input="{Binding Input}"
                                     Output="{Binding Output}"
                                     Status="{Binding Status}"/>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
        
      </StackPanel>
      
    </ScrollViewer>
    
    <!-- Mode Banner -->
    <Border Grid.Row="1"
            Background="{Binding HasPendingPlan, Converter={StaticResource BoolToBrushConverter}, ConverterParameter=Plan}"
            IsVisible="{Binding CurrentMode, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=Plan}"
            Padding="16,10"
            CornerRadius="8"
            Margin="16,8">
      <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
        <PathIcon Data="{StaticResource PlanIcon}" Width="16" Height="16"/>
        <TextBlock Text="Plan Mode - Review and approve before execution" FontSize="13"/>
        <Button Content="Approve" 
                Command="{Binding ApprovePlanCommand}"
                Classes="PrimaryButton"
                Padding="12,6"
                FontSize="12"
                IsVisible="{Binding HasPendingPlan}"/>
      </StackPanel>
    </Border>
    
    <!-- Input Area - 1Code风格 -->
    <Border Grid.Row="2"
            Background="#0F0F0F"
            BorderThickness="0,1,0,0"
            BorderBrush="{DynamicResource BorderColor}"
            Padding="20,16,20,20">
      
      <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Bottom">
        
        <!-- Text Input -->
        <Border Grid.Column="0"
                Background="#1C1C1E"
                CornerRadius="12"
                Padding="2,2,2,2">
          <TextBox Text="{Binding CurrentMessage}"
                   AcceptsReturn="True"
                   MinHeight="48"
                   MaxHeight="150"
                   Watermark="Ask FlowClaude to help with your code..."
                   Background="Transparent"
                   BorderThickness="0"
                   Padding="14,12"
                   FontSize="14"
                   TextWrapping="Wrap"
                   Foreground="{DynamicResource AppForeground}"
                   KeyDown="OnInputKeyDown">
            <TextBox.Styles>
              <Style Selector="TextBox">
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Background" Value="Transparent"/>
              </Style>
              <Style Selector="TextBox:focus">
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Background" Value="Transparent"/>
              </Style>
            </TextBox.Styles>
          </TextBox>
        </Border>
        
        <!-- Send Button -->
        <Button Grid.Column="1"
                Command="{Binding SendMessageCommand}"
                IsEnabled="{Binding IsProcessing, Converter={StaticResource BoolToBoolConverter}, ConverterParameter=Invert}}"
                Background="{DynamicResource PrimaryColor}"
                Foreground="White"
                CornerRadius="10"
                Width="44"
                Height="44"
                Padding="0"
                Margin="12,0,0,0">
          <PathIcon Data="{StaticResource SendIcon}"
                    Width="20"
                    Height="20"/>
        </Button>
        
      </Grid>
      
    </Border>
    
  </Grid>

</UserControl>