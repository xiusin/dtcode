<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="FlowClaude.App.Controls.ChatMessageView"
             xmlns:vm="using:FlowClaude.App.ViewModels"
             x:DataType="vm:ChatMessageViewModel">
  
  <Grid ColumnDefinitions="Auto,*" Margin="0,8">
    
    <!-- Avatar -->
    <Border Grid.Column="0"
            Width="32"
            Height="32"
            CornerRadius="16"
            Background="{Binding Role, Converter={StaticResource RoleToBrushConverter}}"
            Margin="0,4,12,0">
      <PathIcon Data="{Binding Role, Converter={StaticResource RoleToIconConverter}}"
                Width="18" Height="18"
                Foreground="White"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"/>
    </Border>
    
    <!-- Message Content -->
    <StackPanel Grid.Column="1">
      
      <!-- Role Label -->
      <TextBlock Text="{Binding Role, Converter={StaticResource RoleToTextConverter}}"
                 FontSize="12"
                 FontWeight="SemiBold"
                 Foreground="{DynamicResource MutedForeground}"
                 Margin="0,0,0,4"/>
      
      <!-- Content -->
      <TextBox Text="{Binding Content}"
               IsReadOnly="True"
               Background="Transparent"
               BorderThickness="0"
               Padding="0"
               FontSize="14"
               TextWrapping="Wrap"
               Foreground="{Binding IsError, Converter={StaticResource BoolToBrushConverter}, ConverterParameter=Error}"/>
      
      <!-- Streaming indicator -->
      <StackPanel IsVisible="{Binding IsStreaming}"
                  Orientation="Horizontal"
                  Spacing="4"
                  Margin="0,4,0,0">
        <Ellipse Width="6" Height="6" Fill="{DynamicResource PrimaryColor}" Opacity="0.6"/>
        <Ellipse Width="6" Height="6" Fill="{DynamicResource PrimaryColor}" Opacity="0.6"/>
        <Ellipse Width="6" Height="6" Fill="{DynamicResource PrimaryColor}" Opacity="0.6"/>
      </StackPanel>
      
      <!-- Timestamp -->
      <TextBlock Text="{Binding Timestamp, StringFormat='HH:mm'}"
                 FontSize="11"
                 Foreground="{DynamicResource MutedForeground}"
                 Margin="0,4,0,0"
                 Opacity="0.6"/>
      
    </StackPanel>
    
  </Grid>
  
</UserControl>
